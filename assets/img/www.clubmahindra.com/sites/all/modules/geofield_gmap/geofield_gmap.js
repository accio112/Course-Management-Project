function geofield_gmap_center(e){google.maps.event.trigger(geofield_gmap_data[e].map,"resize"),geofield_gmap_data[e].map.setCenter(geofield_gmap_data[e].marker.getPosition())}function geofield_gmap_marker(e){if(!geofield_gmap_data[e].confirm_center_marker||window.confirm("Change marker position ?")){google.maps.event.trigger(geofield_gmap_data[e].map,"resize");var a=geofield_gmap_data[e].map.getCenter();geofield_gmap_data[e].marker.setPosition(a),geofield_gmap_data[e].lat.val(a.lat()),geofield_gmap_data[e].lng.val(a.lng()),geofield_gmap_data[e].search&&geofield_gmap_geocoder.geocode({latLng:a},function(a,o){o==google.maps.GeocoderStatus.OK&&a[0]&&geofield_gmap_data[e].search.val(a[0].formatted_address)})}}function geofield_gmap_initialize(e){geofield_gmap_data[e.mapid]=e,jQuery.noConflict(),geofield_gmap_geocoder||(geofield_gmap_geocoder=new google.maps.Geocoder);var a=new google.maps.LatLng(e.lat,e.lng),o={zoom:Number(e.zoom),center:a,mapTypeId:google.maps.MapTypeId.SATELLITE,scaleControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE}};switch(e.map_type){case"ROADMAP":o.mapTypeId=google.maps.MapTypeId.ROADMAP;break;case"SATELLITE":o.mapTypeId=google.maps.MapTypeId.SATELLITE;break;case"HYBRID":o.mapTypeId=google.maps.MapTypeId.HYBRID;break;case"TERRAIN":o.mapTypeId=google.maps.MapTypeId.TERRAIN;break;default:o.mapTypeId=google.maps.MapTypeId.ROADMAP}var g=new google.maps.Map(document.getElementById(e.mapid),o);geofield_gmap_data[e.mapid].map=g,google.maps.event.addListener(g,"idle",function(){google.maps.event.trigger(g,"resize")}),google.maps.event.addListenerOnce(g,"idle",function(){jQuery("#"+e.mapid).closest("div.vertical-tabs").find(".vertical-tab-button a").click(function(){google.maps.event.trigger(g,"resize"),geofield_gmap_center(e.mapid)}),jQuery("#"+e.mapid).closest("fieldset.collapsible").find("a.fieldset-title").click(function(){google.maps.event.trigger(g,"resize"),geofield_gmap_center(e.mapid)})});var t=new google.maps.Marker({map:g,draggable:e.widget});geofield_gmap_data[e.mapid].marker=t,t.setPosition(a),e.widget&&e.latid&&e.lngid&&(geofield_gmap_data[e.mapid].lat=jQuery("#"+e.latid),geofield_gmap_data[e.mapid].lng=jQuery("#"+e.lngid),e.searchid&&(geofield_gmap_data[e.mapid].search=jQuery("#"+e.searchid),geofield_gmap_data[e.mapid].search.autocomplete({source:function(e,a){geofield_gmap_geocoder.geocode({address:e.term},function(e,o){a(jQuery.map(e,function(e){return{label:e.formatted_address,value:e.formatted_address,latitude:e.geometry.location.lat(),longitude:e.geometry.location.lng()}}))})},select:function(a,o){geofield_gmap_data[e.mapid].lat.val(o.item.latitude),geofield_gmap_data[e.mapid].lng.val(o.item.longitude);var i=new google.maps.LatLng(o.item.latitude,o.item.longitude);t.setPosition(i),g.setCenter(i)}}),geofield_gmap_data[e.mapid].search.keydown(function(a){if(13==a.which){var o=geofield_gmap_data[e.mapid].search.val();geofield_gmap_geocoder.geocode({address:o},function(a,o){if(o==google.maps.GeocoderStatus.OK&&a[0]){var i=new google.maps.LatLng(a[0].geometry.location.lat(),a[0].geometry.location.lng());t.setPosition(i),g.setCenter(i),geofield_gmap_data[e.mapid].lat.val(t.getPosition().lat()),geofield_gmap_data[e.mapid].lng.val(t.getPosition().lng())}})}}),google.maps.event.addListener(t,"drag",function(){geofield_gmap_geocoder.geocode({latLng:t.getPosition()},function(a,o){o==google.maps.GeocoderStatus.OK&&a[0]&&(geofield_gmap_data[e.mapid].search.val(a[0].formatted_address),geofield_gmap_data[e.mapid].lat.val(t.getPosition().lat()),geofield_gmap_data[e.mapid].lng.val(t.getPosition().lng()))})})),e.click_to_place_marker&&google.maps.event.addListener(g,"click",function(a){var o=new google.maps.LatLng(a.latLng.lat(),a.latLng.lng());t.setPosition(o),geofield_gmap_data[e.mapid].lat.val(o.lat()),geofield_gmap_data[e.mapid].lng.val(o.lng())}),geofield_onchange=function(){var a=new google.maps.LatLng(parseInt(geofield_gmap_data[e.mapid].lat.val()),parseInt(geofield_gmap_data[e.mapid].lng.val()));t.setPosition(a),g.setCenter(a)},geofield_gmap_data[e.mapid].lat.change(geofield_onchange),geofield_gmap_data[e.mapid].lng.change(geofield_onchange))}!function(e){Drupal.behaviors.geofieldMapInit={attach:function(a,o){o.geofield_gmap&&e.each(o.geofield_gmap,function(e,a){geofield_gmap_initialize({lat:a.lat,lng:a.lng,zoom:a.zoom,latid:a.latid,lngid:a.lngid,searchid:a.searchid,mapid:a.mapid,widget:a.widget,map_type:a.map_type,confirm_center_marker:a.confirm_center_marker,click_to_place_marker:a.click_to_place_marker})})}}}(jQuery);var geofield_gmap_geocoder,geofield_gmap_data=[];
